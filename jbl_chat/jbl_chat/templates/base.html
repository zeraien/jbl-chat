{% load django_htmx %}
<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
          crossorigin="anonymous">
    <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx-ext-ws@2.0.3/ws.min.js"></script>
    <style>
        #chatMain {
            flex-direction: column;
        }

        #sidebar {
            flex: 0;
        }

        #conversationSelectDropdown
        {
            display: inline;
        }

        #sidebarUserList
        {
            display: none;
        }

        #activeConversation {
            flex: 1 0;
            position: relative;
        }

        @media (min-width: 576px) {
            #chatMain {
                flex-direction: row;
            }
            #conversationSelectDropdown
            {
                display: none;
            }
            #sidebar {
                flex: 0 1 25%;
            }
            #sidebarUserList
            {
                display: inherit;
            }
        }

        #activeConversationMessages {
            overflow-y: scroll;
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 10px;
            right: 10px;
            height: 90%;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }

        #composeBox {
            position: absolute;
            left: 10px;
            right: 10px;
            bottom: 10px;
        }

        .container.main {
            margin-top: 65px;
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            bottom: 20px;
            overflow: hidden;
        }
    </style>
    <script type='text/javascript'>
        htmx.on("htmx:load", function (evt) {
            try {
                $('#activeConversationMessages .last_message')[0].scrollIntoView();
            } catch (e) {
                // hacky way to avoid checking for the existence of .last_message
            }
        });

        // manage the websockets connection information badge
        htmx.on("htmx:wsOpen", function (evt) {
            $('#connectionStatus').attr('class', 'badge text-bg-success').text('CONNECTED');
        });
        htmx.on("htmx:wsConnecting", function (evt) {
            $('#connectionStatus').attr('class', 'badge text-bg-warning').text('CONNECTING');
        });
        htmx.on("htmx:wsClose", function (evt) {
            $('#connectionStatus').attr('class', 'badge text-bg-danger').text('DISCONNECTED');
        });
    </script>

</head>
<body hx-ext="ws"
      hx-headers='{"X-Requested-With": "XMLHttpRequest", "x-csrftoken": "{{ csrf_token }}"}'>
<div class="fixed-top">
    <nav class="navbar navbar-light bg-light navbar-fixed-top">
        <div class='container-fluid'>
            <div class="navbar-brand">
                <b>{{ request.user }}</b> @ JblChat
                &ensp;
                <span id='connectionStatus' class='badge text-bg-danger'>DISCONNECTED</span>
            </div>
            <div class='mr-auto'><!-- for login button alignment to the right --></div>
            <div class="my-2 my-lg-0">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="btn btn-info" href="/dashboard/login/">LOGIN</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

<div class="container main">
    {% block main %}
    {% endblock main %}
</div>

<div class="fixed-bottom">
    <nav class="navbar navbar-fixed-bottom"></nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>
</html>
